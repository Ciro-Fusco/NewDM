<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CassaController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">NewDMApp</a> &gt; <a href="index.source.html" class="el_package">business.cassa</a> &gt; <span class="el_source">CassaController.java</span></div><h1>CassaController.java</h1><pre class="source lang-java linenums">package business.cassa;

import exceptions.DatabaseException;
import exceptions.ProdottoException;
import exceptions.ScontrinoException;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Label;
import javafx.scene.control.TextArea;
import javafx.scene.control.TextField;
import javafx.scene.input.MouseEvent;
import business.utenza.Utente;
import presentazione.AlertMessage;
import presentazione.App;

import java.io.IOException;
import java.net.URL;
import java.util.ResourceBundle;

/**
 * Controller per le interazioni della sezione Cassa
 */
<span class="fc" id="L23">public class CassaController implements Initializable {</span>

  private static Scontrino scontrino;
  @FXML
  private TextField codiceProd;
  @FXML
  private TextArea scontrinoTextField;
  @FXML
  private TextField sommaVersataTextField;
  @FXML
  private Label totaleLabel;
  @FXML
  private TextArea riepilogoTextArea;
  @FXML
  private Label restoLabel;

  @Override
  public void initialize(URL url, ResourceBundle resourceBundle) {
<span class="fc" id="L41">    String nomeFile =</span>
<span class="fc" id="L42">            url.toString().substring(url.toString().lastIndexOf('/') + 1, url.toString().length());</span>

<span class="fc bfc" id="L44" title="All 2 branches covered.">    if (nomeFile.equals(&quot;Cassa.fxml&quot;)) {</span>
<span class="fc bfc" id="L45" title="All 2 branches covered.">      if (scontrino != null) {</span>
<span class="fc" id="L46">        scontrinoTextField.appendText(scontrino.getRiepilogo());</span>
      } else {
<span class="fc" id="L48">        System.out.println();</span>
      }
    } else {
<span class="fc" id="L51">      System.out.println();</span>
    }

<span class="fc bfc" id="L54" title="All 2 branches covered.">    if (nomeFile.equals(&quot;CassaTotaleForm.fxml&quot;)) {</span>
<span class="fc" id="L55">      scontrino.calcolaTot();</span>
<span class="fc" id="L56">      totaleLabel.setText(Double.toString(scontrino.getTot()));</span>
    } else {
<span class="fc" id="L58">      System.out.println();</span>
    }

<span class="fc bfc" id="L61" title="All 2 branches covered.">    if (nomeFile.equals(&quot;CassaRiepilogo.fxml&quot;)) {</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">      if (scontrino != null) {</span>
<span class="fc" id="L63">        scontrino.calcolaResto();</span>
<span class="fc" id="L64">        restoLabel.setText(String.format(&quot;%.2f&quot;, scontrino.getResto()));</span>
<span class="fc" id="L65">        riepilogoTextArea.setText(scontrino.getRiepilogo());</span>
      } else {
<span class="fc" id="L67">        System.out.println();</span>
      }
    } else {
<span class="fc" id="L70">      System.out.println();</span>
    }
<span class="fc" id="L72">  }</span>

  // CassaController

  /**
   * Apre la dashboard
   *
   * @param mouseEvent
   * @throws IOException
   */
  public void openDashboard(MouseEvent mouseEvent) throws IOException, DatabaseException {
<span class="nc" id="L83">    Utente.logout();</span>
<span class="nc" id="L84">    App.setRoot(&quot;Dashboard&quot;);</span>
<span class="nc" id="L85">  }</span>

  /**
   * Apre la schermata di inserimento del codice Prodotto
   *
   * @param mouseEvent
   * @throws IOException
   */
  public void openCassaInsProdotto(MouseEvent mouseEvent) throws IOException {
<span class="nc" id="L94">    App.setRoot(&quot;CassaInsProdottoForm&quot;);</span>
<span class="nc" id="L95">  }</span>

  /**
   * Apre la schermata di riepilogo dello Scontrino
   *
   * @param mouseEvent
   * @throws IOException
   */
  public void openCassaTotale(MouseEvent mouseEvent) throws IOException {
<span class="fc bfc" id="L104" title="All 4 branches covered.">    if (scontrino != null &amp;&amp; scontrino.getList() != null) {</span>
<span class="nc" id="L105">      App.setRoot(&quot;CassaTotaleForm&quot;);</span>
    } else {
<span class="fc" id="L107">      AlertMessage.showError(&quot;Per procedere, aggiungere almeno un prodotto allo scontrino&quot;);</span>
    }
<span class="fc" id="L109">  }</span>

  /**
   * Elimina lo Scontrino attuale
   *
   * @param mouseEvent
   */
  public void annullaInsProd(MouseEvent mouseEvent) {
<span class="nc" id="L117">    scontrino = new Scontrino();</span>
<span class="nc" id="L118">    scontrinoTextField.setText(&quot;&quot;);</span>
<span class="nc" id="L119">  }</span>
  //////////////////////////////////////////////////////////////////

  // inserimento prodotto

  /**
   * Apre la schermata CassaController
   *
   * @param mouseEvent
   * @throws IOException
   */
  public void openCassa(MouseEvent mouseEvent) throws IOException {
<span class="nc" id="L131">    App.setRoot(&quot;Cassa&quot;);</span>
<span class="nc" id="L132">  }</span>

  /**
   * Inserisce il Prodotto nello scontrino
   *
   * @param mouseEvent
   * @throws ProdottoException Prodotto non trovato
   * @throws DatabaseException Errore nel Database
   */
  public void inserimentoProdotto(MouseEvent mouseEvent)
          throws ProdottoException, DatabaseException {
    try {
<span class="fc bfc" id="L144" title="All 2 branches covered.">      if (scontrino == null) {</span>
<span class="fc" id="L145">        scontrino = new Scontrino();</span>
      } else {
<span class="fc" id="L147">        System.out.println();</span>
      }
      ;
<span class="fc" id="L150">      scontrino.addProdotto(Long.parseLong(codiceProd.getText()));</span>
<span class="fc" id="L151">      AlertMessage.showInformation(&quot;Prodotto inserito correttamente&quot;);</span>
<span class="nc" id="L152">    } catch (NumberFormatException excpt) {</span>
<span class="nc" id="L153">      excpt.printStackTrace();</span>
<span class="nc" id="L154">      AlertMessage.showError(&quot;Compilare i campi in modo corretto&quot;);</span>
<span class="fc" id="L155">    }</span>
<span class="fc" id="L156">  }</span>

  ////////////////////////////////////////////////////////////////

  // Totale cassa

  /**
   * Gestisce l'inserimento della somma versata
   *
   * @param mouseEvent
   * @throws IOException
   * @throws ScontrinoException
   */
  public void openCassaRiepilogo(MouseEvent mouseEvent) throws IOException, ScontrinoException {
<span class="fc bfc" id="L170" title="All 2 branches covered.">    if (sommaVersataTextField.getText().matches(&quot;[0-9]+(\\.[0-9][0-9]?)?&quot;)) {</span>
      try {
<span class="fc" id="L172">        scontrino.setVersato(Double.parseDouble(sommaVersataTextField.getText()));</span>
<span class="nc" id="L173">        App.setRoot(&quot;CassaRiepilogo&quot;);</span>
<span class="nc" id="L174">      } catch (NumberFormatException exception) {</span>
<span class="nc" id="L175">        exception.printStackTrace();</span>
<span class="nc" id="L176">        AlertMessage.showError(&quot;Compila i campi in modo corretto&quot;);</span>
<span class="nc" id="L177">      }</span>
    } else {
<span class="fc" id="L179">      AlertMessage.showError(&quot;Inserisci una somma valida&quot;);</span>
    }
<span class="fc" id="L181">  }</span>

  ////////////////////////////////////////////////////////////////

  // Riepilogo CassaController

  /**
   * Salva lo Scontrino
   *
   * @param mouseEvent
   * @throws DatabaseException
   * @throws IOException
   */
  public void confermaScontrino(MouseEvent mouseEvent) throws DatabaseException, IOException {
<span class="nc" id="L195">    scontrino.save();</span>
<span class="nc" id="L196">    AlertMessage.showInformation(&quot;Scontrino salvato&quot;);</span>
<span class="nc" id="L197">    scontrino = null;</span>
<span class="nc" id="L198">    App.setRoot(&quot;Cassa&quot;);</span>
<span class="nc" id="L199">  }</span>

  /////////////////////////////////////////////////////////////////

  // GET E SETTER PER TEST

  public static Scontrino getScontrino() {
<span class="fc" id="L206">    return scontrino;</span>
  }

  public static void setScontrino(Scontrino scontrino) {
<span class="fc" id="L210">    CassaController.scontrino = scontrino;</span>
<span class="fc" id="L211">  }</span>

  public TextField getCodiceProd() {
<span class="nc" id="L214">    return codiceProd;</span>
  }

  public void setCodiceProd(TextField codiceProd) {
<span class="fc" id="L218">    this.codiceProd = codiceProd;</span>
<span class="fc" id="L219">  }</span>

  public TextArea getScontrinoTextField() {
<span class="fc" id="L222">    return scontrinoTextField;</span>
  }

  public void setScontrinoTextField(TextArea scontrinoTextField) {
<span class="fc" id="L226">    this.scontrinoTextField = scontrinoTextField;</span>
<span class="fc" id="L227">  }</span>

  public TextField getSommaVersataTextField() {
<span class="nc" id="L230">    return sommaVersataTextField;</span>
  }

  public void setSommaVersataTextField(TextField sommaVersataTextField) {
<span class="fc" id="L234">    this.sommaVersataTextField = sommaVersataTextField;</span>
<span class="fc" id="L235">  }</span>

  public Label getTotaleLabel() {
<span class="fc" id="L238">    return totaleLabel;</span>
  }

  public void setTotaleLabel(Label totaleLabel) {
<span class="fc" id="L242">    this.totaleLabel = totaleLabel;</span>
<span class="fc" id="L243">  }</span>

  public TextArea getRiepilogoTextArea() {
<span class="fc" id="L246">    return riepilogoTextArea;</span>
  }

  public void setRiepilogoTextArea(TextArea riepilogoTextArea) {
<span class="fc" id="L250">    this.riepilogoTextArea = riepilogoTextArea;</span>
<span class="fc" id="L251">  }</span>

  public Label getRestoLabel() {
<span class="fc" id="L254">    return restoLabel;</span>
  }

  public void setRestoLabel(Label restoLabel) {
<span class="fc" id="L258">    this.restoLabel = restoLabel;</span>
<span class="fc" id="L259">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>